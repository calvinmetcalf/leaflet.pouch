(function(){L.GeoJSON.Pouch=L.GeoJSON.extend({defaultParams:{continuous:true,direction:"from"},initialize:function(t,e,i){var o,r,n=this;if(typeof e==="object"){i=e;e=void 0}this._layers={};r=L.Util.extend({},this.defaultParams);for(o in i){if(r.hasOwnProperty(o)){r[o]=i[o]}}this.pouchParams=r;L.Util.setOptions(this,i);return Pouch(t,function(t,i){if(!t){n.localDB=i;n.localDB.changes({continuous:n.pouchParams.continuous,include_docs:true,onChange:function(t){var e;e=t.doc;if(parseInt(e._rev.slice(0,1))===1){if("geometry"in e){n.addData(e)}}else if(parseInt(e._rev.slice(0,1))>1){n.eachLayer(function(t){if(t.feature._id===e._id){return n.removeLayer(t)}});if("geometry"in e){if(!e._deleted){n.addData(e)}}}return true}});if(e){return Pouch(e,function(t,e){if(!t){n.remoteDB=e;n.sync=function(t){var e,i;i={continuous:this.pouchParams.continuous};switch(this.pouchParams.direction){case"from":this._from=this.localDB.replicate.from(this.remoteDB,i);break;case"to":this._to=this.localDB.replicate.to(this.remoteDB,i);break;case"both":this._from=this.localDB.replicate.from(this.remoteDB,i);this._to=this.localDB.replicate.to(this.remoteDB,i);break;default:e=true}if(t){if(!e){t(null,true)}if(e){return t("No Option")}}};return n.sync()}})}}})},addDoc:function(t,e){if("type"in t&&t.type==="Feature"){this.localDB.post(t,e||function(){if(!("_id"in t)){return true}});return this.localDB.put(t,e||function(){if("_id"in t&&t._id.slice(0,8)!=="_design/"){return true}})}else if("type"in t&&t.type==="FeatureCollection"){return this.localDB.bulkDocs(t.features,e||function(){return true})}else if(t.length){return this.localDB.bulkDocs(t,e||function(){return true})}},deleteDoc:function(t,e){var i=this;return this.localDB.get(t,function(t,o){if(!t){i.localDB.remove(o,e)}if(t){return e("err")}})},cancel:function(t){switch(this.pouchParams.direction){case"from":this._from.cancel();break;case"to":this._to.cancel();break;case"both":this._from.cancel();this._to.cancel()}return t(null,true)}});L.geoJson.pouch=function(t,e,i){return new L.GeoJSON.Pouch(t,e,i)}}).call(this);