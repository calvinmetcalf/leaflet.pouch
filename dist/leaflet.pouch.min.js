(function(){L.GeoJSON.Pouch=L.GeoJSON.extend({defaultParams:{continuous:true,direction:"from"},initialize:function(e,t){var i,o,r,n=this;if(typeof e==="object"){t=e;e=void 0}if(e){if(e.slice(0,3)==="idb"){i=e;e=void 0}else if(e.slice(0,4)==="http"){if(t&&t.idbName){i="idb://"+t.idbName}else{i="idb://"+e.split("/").pop()}}}else{if(t&&t.idbName){i="idb://"+t.idbName}else{i="idb://"+location.href.split("/").pop()}}this._layers={};r=L.Util.extend({},this.defaultParams);for(o in t){if(r.hasOwnProperty(o)){r[o]=t[o]}}this.pouchParams=r;L.Util.setOptions(this,t);return Pouch(i,function(t,i){if(!t){n.localDB=i;n.localDB.changes({continuous:n.pouchParams.continuous,include_docs:true,onChange:function(e){var t;t=e.doc;if(parseInt(t._rev.slice(0,1))===1){if("geometry"in t){n.addData(t)}}else if(parseInt(t._rev.slice(0,1))>1){n.eachLayer(function(e){if(e.feature._id===t._id){return n.removeLayer(e)}});if("geometry"in t){if(!t._deleted){n.addData(t)}}}return true}});if(e){return Pouch(e,function(e,t){if(!e){n.remoteDB=t;n.sync=function(e){var t,i;i={continuous:this.pouchParams.continuous};switch(this.pouchParams.direction){case"from":this._from=this.localDB.replicate.from(this.remoteDB,i);break;case"to":this._to=this.localDB.replicate.to(this.remoteDB,i);break;case"both":this._from=this.localDB.replicate.from(this.remoteDB,i);this._to=this.localDB.replicate.to(this.remoteDB,i);break;default:t=true}if(e){if(!t){e(null,true)}if(t){return e("No Option")}}};return n.sync()}})}}})},addDoc:function(e,t){if(t==null){t=function(){return true}}if("type"in e&&e.type==="Feature"){if(!("_id"in e)){return this.localDB.post(e,t)}else if("_id"in e&&e._id.slice(0,8)!=="_design/"){return this.localDB.put(e,t)}}else if("type"in e&&e.type==="FeatureCollection"){return this.localDB.bulkDocs(e.features,t)}else if(e.length){return this.localDB.bulkDocs(e,t)}},getDoc:function(e,t){if(t==null){t=function(){return true}}return this.localDB.get(e,t)},deleteDoc:function(e,t){var i=this;if(t==null){t=function(){return true}}return this.getDoc(e,function(e,o){if(!e){i.localDB.remove(o,t)}if(e){return t("err")}})},cancel:function(e){switch(this.pouchParams.direction){case"from":this._from.cancel();break;case"to":this._to.cancel();break;case"both":this._from.cancel();this._to.cancel()}return e(null,true)}});L.geoJson.pouch=function(e,t,i){return new L.GeoJSON.Pouch(e,t,i)}}).call(this);