{"ts":1353790533483,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"L.GeoJSON.Pouch = L.GeoJSON.extend(\r\n\tdefaultParams:\r\n\t\tcontinuous: true\r\n\t\tdirection: \"from\"\r\n\r\n\tinitialize: (db, remoteDB, opts) ->\r\n\t\tif typeof remoteDB is \"object\"\r\n\t\t\topts = remoteDB\r\n\t\t\tremoteDB = undefined\r\n\t\t@_layers = {}\r\n\t\tpouchParams = L.Util.extend({}, @defaultParams)\r\n\t\tfor i of opts\r\n\t\t\tpouchParams[i] = opts[i]  if pouchParams.hasOwnProperty(i)\r\n\t\t@pouchParams = pouchParams\r\n\t\tL.Util.setOptions @, opts\r\n\t\tPouch db, (e1, db1) =>\r\n\t\t\tunless e1\r\n\t\t\t\t@localDB = db1\r\n\t\t\t\t@localDB.changes(\r\n\t\t\t\t\tcontinuous : @pouchParams.continuous\r\n\t\t\t\t\tinclude_docs : true\r\n\t\t\t\t\tonChange : (c) =>\r\n\t\t\t\t\t\tdoc = c.doc\r\n\t\t\t\t\t\tif parseInt(doc._rev.slice(0, 1)) is 1\r\n\t\t\t\t\t\t\t@addData doc if \"geometry\" of doc\r\n\t\t\t\t\t\telse if parseInt(doc._rev.slice(0, 1)) > 1\r\n\t\t\t\t\t\t\t@eachLayer (f) =>\r\n\t\t\t\t\t\t\t\t@removeLayer f  if f.feature._id is doc._id\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif \"geometry\" of doc\r\n\t\t\t\t\t\t\t\t@addData doc  unless doc._deleted\r\n\t\t\t\t\t\ttrue\t\t\t\r\n\t\t\t\t)\r\n\t\t\t\tif remoteDB\r\n\t\t\t\t\tPouch remoteDB, (e2, db2) =>\r\n\t\t\t\t\t\tunless e2\r\n\t\t\t\t\t\t\t@remoteDB = db2\r\n\t\t\t\t\t\t\t@sync = (cb) ->\r\n\t\t\t\t\t\t\t\toptions = continuous : @pouchParams.continuous\r\n\t\t\t\t\t\t\t\tswitch @pouchParams.direction\r\n\t\t\t\t\t\t\t\t\twhen \"from\" then @_from = @localDB.replicate.from @remoteDB, options\r\n\t\t\t\t\t\t\t\t\twhen \"to\" then @_to = @localDB.replicate.to @remoteDB, options\r\n\t\t\t\t\t\t\t\t\twhen \"both\"\r\n\t\t\t\t\t\t\t\t\t\t@_from = @localDB.replicate.from @remoteDB, options\r\n\t\t\t\t\t\t\t\t\t\t@_to = @localDB.replicate.to @remoteDB, options\r\n\t\t\t\t\t\t\t\t\telse noOpt = true\r\n\t\t\t\t\t\t\t\tif cb\r\n\t\t\t\t\t\t\t\t\tcb(null, true) unless noOpt\r\n\t\t\t\t\t\t\t\t\tcb(\"No Option\") if noOpt\r\n\t\t\t\t\t\t\t@sync()\t\r\n\taddDoc: (doc, cb) ->\r\n\t\tif \"type\" of doc and doc.type == \"Feature\"\r\n\t\t\t@localDB.post doc, cb or ()-> true unless \"_id\" of doc\r\n\t\t\t@localDB.put doc, cb or ()-> true if \"_id\" of doc and doc._id.slice(0,8) != \"_design/\"\r\n\t\telse if \"type\" of doc and doc.type == \"FeatureCollection\"\r\n\t\t\t@localDB.bulkDocs doc.features, cb or ()-> true\r\n\t\telse if doc.length\r\n\t\t\t@localDB.bulkDocs doc, cb or ()-> true\r\n\t\t\r\n\t\r\n\tdeleteDoc: (id, cb) ->\r\n\t\t@localDB.get id, (err, doc) =>\r\n\t\t\t@localDB.remove doc, cb unless err\r\n\t\t\tcb(\"err\") if err\r\n\r\n\tcancel: (cb) ->\r\n\t\tswitch @pouchParams.direction\r\n\t\t\twhen \"from\" then @_from.cancel()\r\n\t\t\twhen \"to\" then @_to.cancel()\r\n\t\t\twhen \"both\"\r\n\t\t\t\t@_from.cancel()\r\n\t\t\t\t@_to.cancel()\r\n\t\tcb(null, true)\r\n\t\r\n)\r\nL.geoJson.pouch = (db, remoteDB, opts)->\r\n\tnew L.GeoJSON.Pouch(db, remoteDB, opts)"]],"start1":0,"start2":0,"length1":0,"length2":2385}]],"length":2385}
{"contributors":[],"silentsave":false,"ts":1356960149756,"patch":[[{"diffs":[[0,"oc: (doc, cb"],[-1,""],[0,""],[1," = ()-> true"],[0,") ->\r\n\t\tif \""]],"start1":1582,"start2":1582,"length1":24,"length2":36},{"diffs":[[0,"\n\t\t\t"],[-1,"@localDB.post doc, cb or ()-> true "],[0,"unle"]],"start1":1657,"start2":1657,"length1":43,"length2":8},{"diffs":[[0," of doc\r\n\t\t\t"],[1,"\t"],[0,"@localDB.put"]],"start1":1673,"start2":1673,"length1":24,"length2":25},{"diffs":[[0,"ocalDB.p"],[-1,"u"],[1,"os"],[0,"t doc, c"]],"start1":1688,"start2":1688,"length1":17,"length2":18},{"diffs":[[0,", cb"],[-1," or ()-> true "],[1,"\r\n\t\t\t"],[0,"if \""]],"start1":1703,"start2":1703,"length1":22,"length2":13},{"diffs":[[0,"sign/\"\r\n"],[1,"\t\t\t\t@localDB.put doc, cb \r\n"],[0,"\t\telse i"]],"start1":1758,"start2":1758,"length1":16,"length2":43},{"diffs":[[0,"features, cb"],[-1," or ()-> true"],[0,"\r\n\t\telse if "]],"start1":1879,"start2":1879,"length1":37,"length2":24},{"diffs":[[0,", cb"],[-1," or ()-> true"],[0,"\r\n\t\t"]],"start1":1939,"start2":1939,"length1":21,"length2":8}]],"length":2356,"saved":false}
{"ts":1356960217910,"patch":[[{"diffs":[[0," cb\r\n\t\t\t"],[1,"else "],[0,"if \"_id\""]],"start1":1704,"start2":1704,"length1":16,"length2":21}]],"length":2361,"saved":false}
{"ts":1356961262409,"patch":[[{"diffs":[[0,"c, cb\r\n\t"],[-1,"\t"],[1,"getDoc: (doc, cb = ()-> true) ->\r\n\t\t@localDB.get id, cb"],[0,"\r\n\t\r\n\tde"]],"start1":1943,"start2":1943,"length1":17,"length2":71},{"diffs":[[0," (id, cb"],[1," = ()-> true"],[0,") ->\r\n\t\t"]],"start1":2022,"start2":2022,"length1":16,"length2":28}]],"length":2427,"saved":false}
{"ts":1356961312661,"patch":[[{"diffs":[[0,"rue) ->\r\n\t\t@"],[-1,"localDB."],[0,"get"],[1,"Doc"],[0," id, (err, d"]],"start1":2039,"start2":2039,"length1":35,"length2":30}]],"length":2422,"saved":false}
{"ts":1356961582632,"patch":[[{"diffs":[[0,"\r\n\tgetDoc: ("],[1,"i"],[0,"d"],[-1,"oc"],[0,", cb = ()-> "]],"start1":1948,"start2":1948,"length1":27,"length2":26}]],"length":2421,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357227762933,"patch":[[{"diffs":[[0,"alize: ("],[-1,"db, "],[0,"remoteDB"]],"start1":103,"start2":103,"length1":20,"length2":16},{"diffs":[[0,", opts) ->\r\n"],[1,""],[0,"\t\tif typeof "]],"start1":119,"start2":119,"length1":24,"length2":24},{"diffs":[[0,"moteDB\r\n"],[-1,""],[0,"\t\t\tremot"]],"start1":177,"start2":177,"length1":16,"length2":16},{"diffs":[[0,"efined\r\n"],[1,"\t\tif remoteDB\r\n\t\t\tif remoteDB.slice(0,4)!==\"http\"\r\n\t\t\t\tdb = remoteDB\r\n\t\t\t\tremoteDB = undefined\r\n\t\t\telse if remoteDB.slice(0,4)==\"http\"\r\n\t\t\t\tif opts and opts.idbName\r\n\t\t\t\t\tdb = opts.idbName\r\n\t\t\t\telse\r\n\t\t\t\t\tdb = remoteDB.split(\"/\").pop()\r\n\t\telse\r\n\t\t\tif opts and opts.idbName\r\n\t\t\t\tdb = opts.idbName\r\n\t\t\telse\r\n\t\t\t\tdb = location.href.split(\"/\").pop()\r\n"],[0,"\t\t@_laye"]],"start1":202,"start2":202,"length1":16,"length2":363},{"diffs":[[0,"\t@sync()"],[-1,"\t"],[1,"\r\n\t\t\telse if remoteDB\r\n\t\t\t\tPouch remoteDB, (e3, db3) =>\r\n\t\t\t\t\tunless e3\r\n\t\t\t\t\t\t@localDB = db3\r\n\t\t\t\t\t\t@localDB.changes(\r\n\t\t\t\t\t\t\tcontinuous : @pouchParams.continuous\r\n\t\t\t\t\t\t\tinclude_docs : true\r\n\t\t\t\t\t\t\tonChange : (c) =>\r\n\t\t\t\t\t\t\t\tdoc = c.doc\r\n\t\t\t\t\t\t\t\tif parseInt(doc._rev.slice(0, 1)) is 1\r\n\t\t\t\t\t\t\t\t\t@addData doc if \"geometry\" of doc\r\n\t\t\t\t\t\t\t\telse if parseInt(doc._rev.slice(0, 1)) > 1\r\n\t\t\t\t\t\t\t\t\t@eachLayer (f) =>\r\n\t\t\t\t\t\t\t\t\t\t@removeLayer f  if f.feature._id is doc._id\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif \"geometry\" of doc\r\n\t\t\t\t\t\t\t\t\t\t@addData doc  unless doc._deleted\r\n\t\t\t\t\t\t\t\ttrue\t\t\t\r\n\t\t\t\t\t\t)"],[0,"\r\n\taddDo"]],"start1":1909,"start2":1909,"length1":17,"length2":592}]],"length":3339,"saved":false}
{"ts":1357227817098,"patch":[[{"diffs":[[0,"e(0,4)!="],[-1,"="],[0,"\"http\"\r\n"]],"start1":244,"start2":244,"length1":17,"length2":16}]],"length":3338,"saved":false}
{"ts":1357228608540,"patch":[[{"diffs":[[0,", opts) ->\r\n"],[1,"\t\t@_orig = [remoteDB, opts]\r\n"],[0,"\t\tif typeof "]],"start1":119,"start2":119,"length1":24,"length2":53},{"diffs":[[0," true)\r\n"],[1,"\tdestroy : (cb = ()-> true)->\r\n\t\torig = @_orig\r\n\t\tPouch.destroy @localDB.id(),(err1,resp1)=>\r\n\t\t\tif err1\r\n\t\t\t\tcb err1\r\n\t\t\t\treturn\r\n\t\t\telse if @remoteDB\r\n\t\t\t\tPouch.destroy @remoteDB.id(),(err2,resp2)=>\r\n\t\t\t\t\tif err2\r\n\t\t\t\t\t\tcb err2\r\n\t\t\t\t\t\treturn\r\n\t\t\tcb null, orig\r\n\treboot : () ->\r\n\t\t@destroy (err, resp)=>\r\n\t\t\tunless err\r\n\t\t\t\t@=L.geoJson.pouch(resp...)\r\n\t\t\t\t\r\n\t\t\r\n"],[0,"\t\r\n)\r\nL."]],"start1":3271,"start2":3271,"length1":16,"length2":379},{"diffs":[[0,"ouch = ("],[-1,"db, "],[0,"remoteDB"]],"start1":3659,"start2":3659,"length1":20,"length2":16},{"diffs":[[0,"N.Pouch("],[-1,"db, "],[0,"remoteDB"]],"start1":3699,"start2":3699,"length1":20,"length2":16}]],"length":3722,"saved":false}
{"ts":1357228687424,"patch":[[{"diffs":[[0," () ->\r\n"],[1,"\t\tnewLP = undefined\r\n"],[0,"\t\t@destr"]],"start1":3551,"start2":3551,"length1":16,"length2":37},{"diffs":[[0,"rr\r\n\t\t\t\t"],[-1,"@"],[1,"newLP"],[0,"=L.geoJs"]],"start1":3617,"start2":3617,"length1":17,"length2":21}]],"length":3747,"saved":false}
{"ts":1357228724146,"patch":[[{"diffs":[[0,"sp...)\r\n"],[1,"\t\t@=newLp\r\n"],[0,"\t\t\t\t\r\n\t\t"]],"start1":3649,"start2":3649,"length1":16,"length2":27}]],"length":3758,"saved":false}
{"ts":1357228804664,"patch":[[{"diffs":[[0,"\t\t\t\t"],[-1,"newLP=L.geoJson.pouch(resp...)\r\n\t\t@=newLp"],[1,"@initialize resp..."],[0,"\r\n\t\t"]],"start1":3621,"start2":3621,"length1":49,"length2":27}]],"length":3736,"saved":false}
{"ts":1357230567777,"patch":[[{"diffs":[[0,"->\r\n"],[-1,"\t\tnewLP = undefined\r\n"],[0,"\t\t@d"]],"start1":3555,"start2":3555,"length1":29,"length2":8}]],"length":3715,"saved":false}
{"ts":1357231276480,"patch":[[{"diffs":[[0,"\telse\r\n\t\t\t\t\t"],[-1,"db"],[1,"parts"],[0," = remoteDB."]],"start1":431,"start2":431,"length1":26,"length2":29},{"diffs":[[0,"oteDB.split(\"/\")"],[1,"\r\n\t\t\t\t\tdb = parts.pop()\r\n\t\t\t\t\twhile db == \"\"\r\n\t\t\t\t\t\tdb = parts"],[0,".pop()\r\n\t\telse\r\n"]],"start1":454,"start2":454,"length1":32,"length2":94},{"diffs":[[0,"se\r\n\t\t\t\t"],[-1,"db"],[1,"parts"],[0," = locat"]],"start1":605,"start2":605,"length1":18,"length2":21},{"diffs":[[0,"lit(\"/\")"],[1,"\r\n\t\t\t\tdb = parts.pop()\r\n\t\t\t\twhile db == \"\"\r\n\t\t\t\t\tdb = parts"],[0,".pop()\r\n"]],"start1":637,"start2":637,"length1":16,"length2":75},{"diffs":[[0,"DB\r\n"],[-1,"\t\t\t\t\tPouch remoteDB, (e2, db2) =>\r\n\t\t\t\t\t\tunless e2\r\n\t"],[0,"\t\t\t\t"]],"start1":1447,"start2":1447,"length1":61,"length2":8},{"diffs":[[0," = db2\r\n"],[-1,"\t"],[0,"\t\t\t\t\t\t@s"]],"start1":1466,"start2":1466,"length1":17,"length2":16},{"diffs":[[0,"\n\t\t\t\t\t\t\t"],[-1,"\t"],[0,"options "]],"start1":1496,"start2":1496,"length1":17,"length2":16},{"diffs":[[0,"continuous\r\n"],[-1,"\t"],[0,"\t\t\t\t\t\t\tswitc"]],"start1":1540,"start2":1540,"length1":25,"length2":24},{"diffs":[[0,"on\r\n\t\t\t\t\t\t\t\t"],[-1,"\t"],[0,"when \"from\" "]],"start1":1586,"start2":1586,"length1":25,"length2":24},{"diffs":[[0,"oteDB, options\r\n"],[-1,"\t"],[0,"\t\t\t\t\t\t\t\twhen \"to"]],"start1":1652,"start2":1652,"length1":33,"length2":32},{"diffs":[[0,"ns\r\n\t\t\t\t\t\t\t\t"],[-1,"\t"],[0,"when \"both\"\r"]],"start1":1736,"start2":1736,"length1":25,"length2":24},{"diffs":[[0,"\"both\"\r\n"],[-1,"\t"],[0,"\t\t\t\t\t\t\t\t"]],"start1":1753,"start2":1753,"length1":17,"length2":16},{"diffs":[[0,"\t\t\t\t\t\t\t\t"],[-1,"\t"],[0,"@_to = @"]],"start1":1824,"start2":1824,"length1":17,"length2":16},{"diffs":[[0,"oteDB, options\r\n"],[-1,"\t"],[0,"\t\t\t\t\t\t\t\telse noO"]],"start1":1865,"start2":1865,"length1":33,"length2":32},{"diffs":[[0,"\t\t\t\t"],[-1,"\t"],[0,"if cb\r\n"],[-1,"\t"],[0,"\t\t\t\t"]],"start1":1911,"start2":1911,"length1":17,"length2":15},{"diffs":[[0,"\t\t\t\t\t\t\t\t"],[-1,"\t"],[0,"cb(\"No O"]],"start1":1959,"start2":1959,"length1":17,"length2":16},{"diffs":[[0,") if noOpt\r\n"],[-1,"\t"],[0,"\t\t\t\t\t\t@sync("]],"start1":1981,"start2":1981,"length1":25,"length2":24}]],"length":3776,"saved":false}
{"ts":1357233421990,"patch":[[{"diffs":[[0,"B = "],[-1,"db2"],[1,"remoteDB"],[0,"\r\n\t\t"]],"start1":1465,"start2":1465,"length1":11,"length2":16},{"diffs":[[0,"en @_from = "],[-1,"@localDB"],[1,"Pouch"],[0,".replicate.f"]],"start1":1617,"start2":1617,"length1":32,"length2":29},{"diffs":[[0," Pouch.replicate"],[-1,".from"],[1," @localDB,"],[0," @remoteDB, opti"]],"start1":1628,"start2":1628,"length1":37,"length2":42},{"diffs":[[0,"then @_to = "],[-1,"@localDB"],[1,"Pouch"],[0,".replicate.t"]],"start1":1693,"start2":1693,"length1":32,"length2":29},{"diffs":[[0," Pouch.replicate"],[-1,".to"],[0," @remoteDB, opti"]],"start1":1704,"start2":1704,"length1":35,"length2":32},{"diffs":[[0,"icate @remoteDB,"],[1," @localDB, "],[0," options\r\n\t\t\t\t\t\t"]],"start1":1715,"start2":1715,"length1":32,"length2":43},{"diffs":[[0,"_from = "],[-1,"@localDB"],[1,"Pouch"],[0,".replica"]],"start1":1783,"start2":1783,"length1":24,"length2":21},{"diffs":[[0,"cate"],[-1,".from"],[1," @localDB,"],[0," @re"]],"start1":1802,"start2":1802,"length1":13,"length2":18},{"diffs":[[0,"\t@_to = "],[-1,"@localDB"],[1,"Pouch"],[0,".replica"]],"start1":1845,"start2":1845,"length1":24,"length2":21},{"diffs":[[0,"cate"],[-1,".to"],[0," @re"]],"start1":1864,"start2":1864,"length1":11,"length2":8},{"diffs":[[0,"icate @remoteDB,"],[1," @localDB, "],[0," options\r\n\t\t\t\t\t\t"]],"start1":1863,"start2":1863,"length1":32,"length2":43}]],"length":3795,"saved":false}
{"ts":1357233492972,"patch":[[{"diffs":[[0,"e)\r\n"],[-1,"\tdestroy : (cb = ()-> true)->\r\n\t\torig = @_orig\r\n\t\tPouch.destroy @localDB.id(),(err1,resp1)=>\r\n\t\t\tif err1\r\n\t\t\t\tcb err1\r\n\t\t\t\treturn\r\n\t\t\telse if @remoteDB\r\n\t\t\t\tPouch.destroy @remoteDB.id(),(err2,resp2)=>\r\n\t\t\t\t\tif err2\r\n\t\t\t\t\t\tcb err2\r\n\t\t\t\t\t\treturn\r\n\t\t\tcb null, orig\r\n\treboot : () ->\r\n\t\t@destroy (err, resp)=>\r\n\t\t\tunless err\r\n\t\t\t\t@initialize resp...\r\n\t\t\t\t\r\n\t\t\r\n\t\r\n"],[0,")\r\nL"]],"start1":3355,"start2":3355,"length1":367,"length2":8}]],"length":3436,"saved":false}
{"ts":1357233696420,"patch":[[{"diffs":[[0,"s = {}\r\n"],[1,"\t\t@_dbName=db\r\n"],[0,"\t\tpouchP"]],"start1":721,"start2":721,"length1":16,"length2":31},{"diffs":[[0,"\t\tPouch "],[-1,"db"],[1,"@_dbName"],[0,", (e1, d"]],"start1":934,"start2":934,"length1":18,"length2":24},{"diffs":[[0," true)\r\n"],[1,"\tdestroy: (cb=()->true)->\r\n\t\tPouch.destroy @_dbName,cb\r\n"],[0,")\r\nL.geo"]],"start1":3372,"start2":3372,"length1":16,"length2":72}]],"length":3513,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357938087644,"patch":[[{"diffs":[[0,"\t\t\t\t\tdb = parts."],[-1,"pop"],[1,"shift"],[0,"()\r\n\t\t\t\t\twhile d"]],"start1":472,"start2":472,"length1":35,"length2":37},{"diffs":[[0,"\tdb = parts."],[-1,"pop"],[1,"shift"],[0,"()\r\n\t\telse\r\n"]],"start1":523,"start2":523,"length1":27,"length2":29},{"diffs":[[0,"ion."],[-1,"href"],[1,"pathname"],[0,".spl"]],"start1":630,"start2":630,"length1":12,"length2":16},{"diffs":[[0,"\tdb = parts."],[-1,"pop"],[1,"shift"],[0,"()\r\n\t\t\t\twhil"]],"start1":658,"start2":658,"length1":27,"length2":29},{"diffs":[[0,"rts."],[-1,"pop"],[1,"shift"],[0,"()\r\n"]],"start1":711,"start2":711,"length1":11,"length2":13}]],"length":3525,"saved":false}
