{"ts":1366911374157,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var dbPath = document.location.protocol+\"//\"+document.location.host+\"/\"+document.location.pathname.split(\"/\")[1];\nvar m= L.map('map').setView([39.40, -96.42], 4),\n\tmq=L.tileLayer(\"http://otile{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.jpeg\", {attribution:'Tiles Courtesy of <a href=\"http://www.mapquest.com/\">MapQuest</a> &mdash; Map data &copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors', subdomains:'1234'}).addTo(m),\n\th = new L.Hash(m),\n\td = new L.Control.Draw().addTo(m),\n\tpouchLayer = L.geoJson.pouch(dbPath,{pointToLayer:pointToLayer,onEachFeature:popUp,direction:\"both\"}).addTo(m);\n\tm.on('drawn', function (e) {\n\t\t\tpouchLayer.addDoc(e.feature, pass);\n\t\t});\n\t\t\n\nfunction pointToLayer(f,l){\n\tif(f.properties.radius){\n\t\treturn L.circle(l, f.properties.radius);\n\t}else{\n\t\treturn L.marker(l);\n\t}\n}\nfunction popUp(f,l){\n    var out = [];\n    if (f.properties){\n        for(var key in f.properties){\n            \tout.push(key+\": \"+f.properties[key] + \" <a href='#' id='key-\"+key+\"' class='delete-row'>x</a>\");\n        }\n        l.bindPopup(\"<div class='\"+ out.lenghth+\"' id='\" + f._id+\"'>\"+out.join(\"<br />\")+\"</div><br /><input type='button' value='Add Row' id='addRow'><input type='button' value='delete' id='deleteDoc'>\");\n    }\n}\nm.on(\"popupopen\",function(e){\n   \n    var id = e.popup._source.feature._id;\n    eee=id;\n    L.DomEvent.addListener(L.DomUtil.get(\"deleteDoc\"),\"click\",function(click){\n        pouchLayer.deleteDoc(id,pass);\n    });\n    L.DomEvent.addListener(L.DomUtil.get(\"addRow\"),\"click\",function(click){\n        var div =L.DomUtil.get(id);\n        var form = L.DomUtil.create(\"form\",\"row-form\");\n        form.id=\"addRowForm\";\n      var kInput =  L.DomUtil.create(\"input\",\"k-input\");\n      kInput.setAttribute(\"style\",\"width:4em\");kInput.setAttribute(\"placeholder\",\"key\");\n      \n      var vInput =  L.DomUtil.create(\"input\",\"v-input\");\n      vInput.setAttribute(\"style\",\"width:4em\");vInput.setAttribute(\"placeholder\",\"value\");\n      form.appendChild(kInput);\n      form.appendChild(vInput);\n      var sub = L.DomUtil.create(\"input\",\"sub-input\");\n      sub.setAttribute(\"type\",\"submit\");\n      sub.setAttribute(\"value\",\"save\");\n      form.appendChild(sub);\n      form.onsubmit=function(e){\n\n        var key = e.target[0].value;\n        var value = e.target[1].value\n        pouchLayer.getDoc(id,function(err,dc){\n            dc.properties[key]=value;\n            pouchLayer.addDoc(dc,pass);\n            })\n        return false;\n        };\n      div.appendChild(form);\n      \n    });\n    $(\".delete-row\").click(function(e){ //almost did this without jquery\n    ee=e;\n        var key = e.currentTarget.id.slice(4)\n        pouchLayer.getDoc(id,function(err,dc){\n            dd=dc;\n            delete dc.properties[key]\n            pouchLayer.addDoc(dc,pass);\n            })\n        });\n});\nfunction pass(){}\n"]],"start1":0,"start2":0,"length1":0,"length2":2861}]],"length":2861}
